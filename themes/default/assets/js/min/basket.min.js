$(function(){$(document).on("ready",function(){$(".price_all_products span").html(number_format(r(),0,"."," "))}),$(".count_product input").on("change",function(){$(this).val()>$(this).data("count")&&($(this).val($(this).data("count")),e("В наличии на складе: "+$(this).data("count"),$(this))),$(this).val()<1&&$(this).val(1),$(this).parent().next(".price_product").children("span").html(number_format($(this).val()*$(this).data("price"),0,"."," ")),$(".price_all_products span").html(number_format(r(),0,"."," ")),$(document).triggerHandler("changeProducts")}),$("input#order-complete-button").on("click",function(){var n=$("#modal-order");return $.modal(n,{minHeight:320,minWidth:300,maxHeight:320,maxWidth:300,opacity:80,overlayClose:!0,focus:!1,autoResize:!1,onShow:function(){$("#modal-order input[name='phone']").mask("8(999)999-99-99"),options={submitHandler:function(e){return t(e),!1},errorClass:"control-group error",rules:{name:{required:!0,russian:!0,maxlength:250},phone:{required:!0}},errorPlacement:function(t,n){var r;return r=n.attr("name"),e(t.text(),n)},highlight:function(e,t){return $(e).addClass(t)},unhighlight:function(e,t){return $(e).removeClass(t)}},n.find("form").validate(options)}}),!1}),$("a#big-order-complete-button").on("click",function(){$("#modal-order input[name='name']").val().length>1&&$("#modal-order-big input[name='name']").val($("#modal-order input[name='name']").val()),$("#modal-order input[name='phone']").val().length>1&&$("#modal-order-big input[name='phone']").val($("#modal-order input[name='phone']").val()),$.modal.close();var n=$("#modal-order-big");return $.modal(n,{minHeight:530,minWidth:300,maxHeight:530,maxWidth:300,opacity:80,overlayClose:!0,focus:!1,autoResize:!1,onShow:function(){$("#modal-order-big input[name='phone']").mask("8(999)999-99-99"),options={submitHandler:function(e){return t(e),!1},errorClass:"control-group error",rules:{name:{required:!0,russian:!0,maxlength:250},email:{required:!0,email:!0,maxlength:250},phone:{required:!0,maxlength:16,minlength:14},address:{required:!0,minlength:10,maxlength:1e3},delivery:{required:!0},pay:{required:!0},messages:{maxlength:1e3}},errorPlacement:function(t,n){var r;return r=n.attr("name"),e(t.text(),n)},highlight:function(e,t){return $(e).addClass(t)},unhighlight:function(e,t){return $(e).removeClass(t)}},n.find("form").validate(options)}}),!1}),$(".del_product a").on("click",function(){var e=$(this);return n(e),!1});var e=function(e,t){t.popover("destroy"),t.popover({animation:!0,placement:"top",trigger:"focus",content:e})},t=function(){ajaxload(),setTimeout(function(){$.modal.close(),$("#modal-order-true").modal({minHeight:280,minWidth:300,maxHeight:280,maxWidth:300,opacity:80,overlayClose:!0,focus:!1,autoResize:!1})},1e3)},n=function(e){2===$("#basket-list tbody tr").length?($(".basket .order-complete").fadeOut(500),e.parents("#basket-list").fadeOut(500,function(){$(this).remove(),$.cookie("products",null),$(document).triggerHandler("changeProducts"),$("div.basket").html("<p>В вашей корзине товаров нет.</p>")})):e.parents("tr").fadeOut(500,function(){$(this).remove(),$(".price_all_products span").html(number_format(r(),0,"."," ")),$(document).triggerHandler("changeProducts")})},r=function(){var e=0,t=new Array;return $(".count_product input").each(function(n,r){e+=$(r).data("price")*$(r).val(),t[n]={id:$(r).data("id"),count:$(r).val(),price:$(r).data("price"),balans_id:$(r).data("balans")}}),$.cookie("products",JSON.stringify(t)),e}});