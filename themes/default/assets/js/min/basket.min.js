!function(){$(document).on("ready",function(){$(".price_all_products span").html(number_format(n(),0,"."," "))}),$(".count_product input").on("change",function(){$(this).val()>$(this).data("count")&&($(this).val($(this).data("count")),e("В наличии на складе: "+$(this).data("count"),$(this))),$(this).val()<1&&$(this).val(1),$(this).parent().next(".price_product").children("span").html(number_format($(this).val()*$(this).data("price"),0,"."," ")),$(".price_all_products span").html(number_format(n(),0,"."," ")),$(document).triggerHandler("changeProducts")}),$("input#order-complete-button").on("click",function(){var o=n();o>=500?($("#modal-order .more_button").css("float","right"),$("#modal-order .mobile-checkbox").css("display","block")):($("#modal-order .more_button").css("float","none"),$("#modal-order .mobile-checkbox").css("display","none")),$("#big-order-complete-button").addClass("basket");var r=$("#modal-order");return $.modal(r,{minHeight:320,minWidth:300,maxHeight:320,maxWidth:300,opacity:80,overlayClose:!0,focus:!1,autoResize:!1,onShow:function(){$("#modal-order input[name='phone']").mask("8 (999) 999-99-99"),r.find("form").validate({submitHandler:function(e){return t(e),!1},errorClass:"control-group error",rules:{name:{required:!0,russian:!0,maxlength:250},phone:{required:!0,maxlength:20,minlength:14}},errorPlacement:function(t,o){var n;return n=o.attr("name"),e(t.text(),o)},highlight:function(e,t){return $(e).addClass(t)},unhighlight:function(e,t){return $(e).removeClass(t)}})}}),!1}),$("#modal-order").on("click","#big-order-complete-button.basket",function(){$("#modal-order input[name='name']").val().length>1&&$("#modal-order-big input[name='name']").val($("#modal-order input[name='name']").val()),$("#modal-order input[name='phone']").val().length>1&&$("#modal-order-big input[name='phone']").val($("#modal-order input[name='phone']").val()),$.modal.close();var o=$("#modal-order-big");return $.modal(o,{minHeight:540,minWidth:300,maxHeight:540,maxWidth:300,opacity:80,overlayClose:!0,focus:!1,autoResize:!1,onShow:function(){$("#modal-order-big input[name='phone']").mask("8 (999) 999-99-99"),o.find("form").validate({submitHandler:function(e){return t(e),!1},errorClass:"control-group error",rules:{name:{required:!0,russian:!0,maxlength:250},email:{required:!0,email:!0,maxlength:250},phone:{required:!0},address:{required:!0,minlength:10,maxlength:1e3},messages:{minlength:0,maxlength:1e3}},errorPlacement:function(t,o){var n;return n=o.attr("name"),e(t.text(),o)},highlight:function(e,t){return $(e).addClass(t)},unhighlight:function(e,t){return $(e).removeClass(t)}})}}),!1}),$(".del_product a").on("click",function(){var e=$(this);return o(e),!1});var e=function(e,t){t.popover("destroy"),t.popover({animation:!0,placement:"top",trigger:"focus",content:e})},t=function(e){ajaxload(),$.ajax({type:"POST",url:$(e).attr("action"),data:$(e).serialize(),dataType:"json",success:function(e){return console.log(e),$.modal.close(),$("#modal-order-true").modal({minHeight:280,minWidth:300,maxHeight:280,maxWidth:300,opacity:80,overlayClose:!0,focus:!1,autoResize:!1,onClose:function(){ajaxload(),$("div.basket").html("<p>В вашей корзине товаров нет.</p>"),$(document).triggerHandler("ready"),$(document).triggerHandler("changeProducts"),setTimeout(function(){$.modal.close()},1e3)}}),!0},error:function(e){$.modal.close(),console.log(e)}})},o=function(e){2===$("#basket-list tbody tr").length?($(".basket .order-complete").fadeOut(500),e.parents("#basket-list").fadeOut(500,function(){$(this).remove(),$.cookie("products",null),$(document).triggerHandler("changeProducts"),$("div.basket").html("<p>В вашей корзине товаров нет.</p>")})):e.parents("tr").fadeOut(500,function(){$(this).remove(),$(".price_all_products span").html(number_format(n(),0,"."," ")),$(document).triggerHandler("changeProducts")})},n=function(){var e=0,t=new Array;return $(".count_product input").each(function(o,n){e+=$(n).data("price")*$(n).val(),t[o]={id:$(n).data("id"),count:$(n).val(),price:$(n).data("price"),balans_id:$(n).data("balans")}}),$.cookie("products",JSON.stringify(t)),e}}();